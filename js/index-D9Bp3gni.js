import W from"./index-C7pjrdL4.js";import{h as g,j as m,k as B,s as u,N as c,v as b,C as p,n as C,J as k,m as n,l as y,y as I,K as M,L as T,e as q,Y as O}from"./vue--1SVMGhC.js";import{_ as D}from"./index-D5LWgAiT.js";import{s as F}from"./pub-DCCNobxc.js";/* empty css              */import"./arco-BAtWUo8v.js";const P="vue-img-cutter",N="3.0.5",U="A image crop plug-in for Vue,you can use it to rotate、zoom images and cut any size",S="ihtmlcss.com",R={serve:"vue-cli-service serve",build:"vue-cli-service build",lint:"vue-cli-service lint"},z={"core-js":"^3.20.3",vue:"^3.2.29","vue-i18n":"^9.1.10"},A={"@vue/cli-plugin-babel":"~4.5.15","@vue/cli-plugin-eslint":"~4.5.15","@vue/cli-service":"~4.5.15","@vue/compiler-sfc":"^3.2.29","babel-eslint":"^10.1.0",eslint:"^6.8.0","eslint-plugin-vue":"^7.20.0"},Y="./src/index.js",j={type:"git",url:"git+https://github.com/acccccccb/vue-img-cutter.git"},E=["image","crop","cutter","vue","裁剪"],X="MIT",V={url:"https://github.com/acccccccb/vue-img-cutter/issues"},G="https://ihtmlcss.com/demo/dist/#/croptool",K={root:!0,env:{node:!0},extends:["plugin:vue/vue3-essential","eslint:recommended"],parserOptions:{parser:"babel-eslint"},rules:{}},J=["> 1%","last 2 versions","not dead"],Q={name:P,version:N,description:U,author:S,private:!1,scripts:R,dependencies:z,devDependencies:A,main:Y,repository:j,keywords:E,license:X,bugs:V,homepage:G,eslintConfig:K,browserslist:J},Z={name:"ImgCutter",props:{crossOrigin:{type:Boolean,default:!1,required:!1},crossOriginHeader:{type:String,default:"*",required:!1},label:{type:String,default:"选择图片",required:!1},isModal:{type:Boolean,default:!0,required:!1},lockScroll:{type:Boolean,default:!0,required:!1},showChooseBtn:{type:Boolean,default:!0,required:!1},boxWidth:{type:Number,default:800,required:!1},boxHeight:{type:Number,default:400,required:!1},cutWidth:{type:Number,default:200,required:!1},cutHeight:{type:Number,default:200,required:!1},rate:{type:String,default:null,required:!1},tool:{type:Boolean,default:!0,required:!1},toolBgc:{type:String,default:"#fff",required:!1},imgMove:{type:Boolean,default:!0,required:!1},sizeChange:{type:Boolean,default:!0,required:!1},originalGraph:{type:Boolean,default:!1,required:!1},moveAble:{type:Boolean,default:!0,required:!1},previewMode:{type:Boolean,default:!0,required:!1},CuttingOriginal:{type:Boolean,default:!1,required:!1},WatermarkText:{type:String,default:"",required:!1},WatermarkTextFont:{type:String,default:"12px Sans-serif",required:!1},WatermarkTextColor:{type:String,default:"#fff",required:!1},WatermarkTextX:{type:Number,default:.95,required:!1},WatermarkTextY:{type:Number,default:.95,required:!1},smallToUpload:{type:Boolean,default:!1,required:!1},saveCutPosition:{type:Boolean,default:!1,required:!1},scaleAble:{type:Boolean,default:!0,required:!1},index:{default:null,required:!1},fileType:{default:"png",required:!1,type:String},toolBoxOverflow:{type:Boolean,default:!0,required:!1},DoNotDisplayCopyright:{type:Boolean,default:!1,required:!1},quality:{type:Number,default:1,required:!1},accept:{type:String,default:"image/gif, image/jpeg ,image/png",required:!1}},model:["label","boxWidth","boxHeight","rate","tool","DoNotDisplayCopyright"],data(){let i,t;return i=this.boxWidth/2,t=this.boxHeight/2,{version:"",visible:!1,fileName:"",cutImageObj:null,onPrintImgTimmer:null,toolBoxPosition:{x:0,y:0},drawImg:{img:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},toolBox:{disable:!0,width:i,height:t,x:0,y:0,boxMove:{start:{x:0,y:0},moveTo:{x:0,y:0}}},dropImg:{active:!1,pageX:0,pageY:0,params:{}},rotateImg:{angle:0},rotateControl:{active:!1,start:{x:0,y:0},position:100},scaleImg:{rate:0,params:{}},controlBox:{disable:!0,btnName:"",start:{x:0,y:0,width:0,height:0}},selectBox:!1,selectBoxColor:"rgba(0,0,0,0.6)",isFlipHorizontal:!1,isFlipVertically:!1}},mounted(){this.version=Q.version,this.isModal===!1&&(this.visible=!0,this.$nextTick(()=>{this.$refs.toolBox&&(this.$refs.toolBox.onmousewheel=this.scaleImgWheel,this.$refs.toolBox.addEventListener("DOMMouseScroll",this.scaleImgWheel))}))},methods:{handleOpen(i){let t=e=>{if(this.$refs.toolBox&&(this.$refs.toolBox.onmousewheel=this.scaleImgWheel,this.$refs.toolBox.addEventListener("DOMMouseScroll",this.scaleImgWheel)),this.isModal===!0){this.lockScroll===!0&&(document.body.style.overflowY="hidden");let s=this.$refs.dialogMainModalRef.offsetHeight+200,r=window.innerHeight,o=this.$refs.mask;s>r?o.style.overflowY="scroll":o.style.overflowY="hidden"}e&&typeof e=="function"&&e()};if(i&&typeof i=="object"&&i.src)if(i.name){let e=new Image;this.crossOrigin===!0&&(e.crossOrigin=this.crossOriginHeader),e.name=i.name,e.style.position="fixed",e.style.top="-5000px",e.style.opacity=0,e.onerror=s=>{this.$emit("error",{index:this.index,event:s,msg:"图片加载失败"}),this.clearCutImageObj()},e.onerror=s=>{throw this.$emit("onImageLoadError",s),new Error("图片加载失败")},e.onload=()=>{if(e.complete===!0)this.$emit("onImageLoadComplete",e),this.visible=!0,this.$nextTick(()=>{t(()=>{this.importImgToCanv(e)})});else throw new Error("图片加载失败")},e.src=i.src,this.cutImageObj=e,document.body.appendChild(e),this.$emit("onChooseImg",i,this.index)}else throw new Error("传入参数必须包含：src,name");else this.visible=!0,this.$nextTick(()=>{t()})},handleClose(){this.clearAll(),this.isModal===!0&&(this.lockScroll===!0&&(document.body.style.overflowY="scroll"),this.$nextTick(()=>{this.visible=!1}))},chooseImg(){this.$refs.inputFile.click()},importImgToCanv(i){let t=i.height,e=i.width,s=this.boxWidth,r=this.boxHeight,o,l={...this.drawImg};this.fileName=i.name,l.img=i,this.scaleImg.rate=e/t,t<r&&e<s?(o=1,l.x=(s-e)/2,l.y=(r-t)/2):e/t<=s/r?(o=r/t,l.x=(s-e*o)/2):(o=s/e,l.y=(r-t*o)/2),l.swidth=e,l.sheight=t,l.width=e*o,l.height=t*o,l.x=(s-l.width)/2,l.y=(r-l.height)/2,this.drawImg=l,this.printImg(),this.putToolBox()},putImgToCanv(i){let t;if(i.target.files)t=i.target.files[0]||null;else return!1;if(t){this.fileName=t.name;let e=new FileReader;e.readAsDataURL(t),e.onload=s=>{let r=s.target.result,o=document.createElement("img");o.src=r;let l=setInterval(()=>{if(e.readyState===2){if(clearInterval(l),!this.sizeChange&&this.smallToUpload&&o.width<=this.cutWidth&&o.height<=this.cutHeight){this.handleClose(),t.name=this.changeFileName(t.name,this.fileType),this.$emit("cutDown",{filename:this.changeFileName(t.name,this.fileType),file:t,index:this.index});return}let h=o.height,d=o.width,a=this.boxWidth,x=this.boxHeight,w,f={...this.drawImg};f.img=o,this.scaleImg.rate=d/h,h<x&&d<a?(w=1,f.x=(a-d)/2,f.y=(x-h)/2):d/h<=a/x?(w=x/h,f.x=(a-d*w)/2):(w=a/d,f.y=(x-h*w)/2),f.swidth=d,f.sheight=h,f.width=d*w,f.height=h*w,f.x=(a-f.width)/2,f.y=(x-f.height)/2,this.drawImg=f,this.printImg(),this.putToolBox()}},200)},this.$emit("onChooseImg",t,this.index)}},putToolBox(){(this.toolBox.width===this.boxWidth/2||this.toolBox.height===this.boxHeight/2||this.saveCutPosition===!1)&&(this.toolBox.width=this.cutWidth>this.boxWidth?this.boxWidth:this.cutWidth,this.toolBox.height=this.cutHeight>this.boxHeight?this.boxHeight:this.cutHeight),(this.toolBox.x===0&&this.toolBox.y===0||this.saveCutPosition===!1)&&(this.toolBox.x=this.boxWidth/2-this.toolBox.width/2,this.toolBox.y=this.boxHeight/2-this.toolBox.height/2),this.checkToolBoxOverflow().then(()=>{this.printImg()}),this.drawControlBox(this.toolBox.width,this.toolBox.height,this.toolBox.x,this.toolBox.y)},checkToolBoxOverflow(){return new Promise(i=>{if(!this.toolBoxOverflow){if(this.drawImg.width<this.toolBox.width||this.drawImg.height<this.toolBox.height){const t=this.drawImg.width/this.drawImg.height;this.drawImg.width<this.toolBox.width&&(this.drawImg.width=this.toolBox.width,this.drawImg.height=this.drawImg.width/t),this.drawImg.height<this.toolBox.height&&(this.drawImg.height=this.toolBox.height,this.drawImg.width=this.drawImg.height*t),this.drawImg.x=(this.boxWidth-this.drawImg.width)/2,this.drawImg.y=(this.boxHeight-this.drawImg.height)/2}this.drawImg.x>this.toolBox.x&&(this.drawImg.x=this.toolBox.x),this.drawImg.x+this.drawImg.width<this.toolBox.x+this.toolBox.width&&(this.drawImg.x=this.toolBox.x+this.toolBox.width-this.drawImg.width),this.drawImg.y>this.toolBox.y&&(this.drawImg.y=this.toolBox.y),this.drawImg.y+this.drawImg.height<this.toolBox.y+this.toolBox.height&&(this.drawImg.y=this.toolBox.y+this.toolBox.height-this.drawImg.height)}i()})},isSupportFileApi(){return!!(window.File&&window.FileList&&window.FileReader&&window.Blob&&navigator.userAgent.indexOf("Edge")===-1&&navigator.userAgent.indexOf("MSIE")===-1&&navigator.userAgent.indexOf("Trident")===-1)},dataURLtoFile(i,t){let e=i.split(","),s=e[0].match(/:(.*?);/)[1],r=atob(e[1]),o=r.length,l=new Uint8Array(o);for(;o--;)l[o]=r.charCodeAt(o);return this.isSupportFileApi()?new File([l],t,{type:s}):"不支持File对象"},clearAll(){let i=this,t=i.$refs.canvas;t.getContext("2d").clearRect(0,0,t.width,t.height);let s=i.$refs.canvasSelectBox;s.getContext("2d").clearRect(0,0,s.width,s.height);let o=i.drawImg.sx,l=i.drawImg.sy;this.drawImg={img:null,sx:o,sy:l,swidth:0,sheight:0,x:0,y:0,width:0,height:0},this.isFlipHorizontal=!1,this.isFlipVertically=!1,this.$refs.inputFile.value="",this.rotateImg.angle=0,this.drawImg.img=null,this.turnReset(),this.clearCutImageObj(),this.$emit("onClearAll",this.index)},clearCutImageObj(){this.cutImageObj!==null&&this.cutImageObj!==void 0&&(typeof this.cutImageObj.remove=="function"?this.cutImageObj.remove():this.cutImageObj.removeNode()),this.cutImageObj=null},drawControlBox(i,t,e,s){this.toolBoxOverflow||(i<1&&(i=1),t<1&&(t=1),i>this.drawImg.width&&(i=this.drawImg.width),t>this.drawImg.height&&(t=this.drawImg.height),e<this.drawImg.x&&(e=this.drawImg.x),s<this.drawImg.y&&(s=this.drawImg.y),e>this.drawImg.x+this.drawImg.width-i&&(e=this.drawImg.x+this.drawImg.width-i),s>this.drawImg.y+this.drawImg.height-t&&(s=this.drawImg.y+this.drawImg.height-t)),i>this.boxWidth&&(i=this.boxWidth),t>this.boxHeight&&(t=this.boxHeight),e<0&&(e=0),s<0&&(s=0);let r=this.$refs.toolBoxControl,o=this.$refs.canvasSelectBox,l=o.getContext("2d");l.fillStyle=this.selectBoxColor,l.clearRect(0,0,o.width,o.height),l.fillRect(0,0,o.width,o.height);let h,d;if(this.rate&&this.rate!==""){let a=this.rate.split(":")[0]/this.rate.split(":")[1];a>=1?(h=i,d=i/a,d+s>this.drawImg.y+this.drawImg.height&&(d=this.drawImg.y+this.drawImg.height-s,h=d*a)):(h=t*a,d=t)}else h=i,d=t;this.toolBox.width=Math.abs(h),this.toolBox.height=Math.abs(d),r.style.width=Math.abs(h)+"px",r.style.height=Math.abs(d)+"px",this.toolBox.boxMove.moveTo.x=e,this.toolBox.boxMove.moveTo.y=s,h<0&&(e=e+h),d<0&&(s=s+d),e+this.toolBox.width>this.boxWidth&&(e=this.boxWidth-this.toolBox.width),e<0&&(e=0),s+this.toolBox.height>this.boxHeight&&(s=this.boxHeight-this.toolBox.height),s<0&&(s=0),this.toolBoxPosition.x=e,this.toolBoxPosition.y=s,r.style.left=e+"px",r.style.top=s+"px",l.clearRect(e,s,Math.abs(h),Math.abs(d)),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(()=>{this.cropPicture(!0)},100)},resetToolBox(){this.toolBox.width<0&&(this.toolBox.boxMove.moveTo.x=this.toolBox.x-this.toolBox.width),this.toolBox.height<0&&(this.toolBox.boxMove.moveTo.y=this.toolBox.y-this.toolBox.height),this.toolBox.width=Math.abs(this.toolBox.width),this.toolBox.height=Math.abs(this.toolBox.height)},toolBoxMouseDown(i){let t=this.$refs.toolBoxControl;this.toolBox.x=parseInt(t.style.left.split("px")[0]),this.toolBox.y=parseInt(t.style.top.split("px")[0]),this.toolBox.disable=!1,this.dropImg.active=!1,this.toolBox.boxMove.start={x:i.pageX,y:i.pageY}},toolBoxMouseMove(i){if(this.dropImg.active&&this.dropImgMove(i),this.toolBox.disable===!1&&this.moveAble===!0){let t=i.pageX-this.toolBox.boxMove.start.x,e=i.pageY-this.toolBox.boxMove.start.y,s=this.toolBox.x+t,r=this.toolBox.y+e;this.drawControlBox(this.toolBox.width,this.toolBox.height,s,r)}},toolBoxMouseLeave(){this.toolBox.disable=!0,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(()=>{this.cropPicture(!0)},100),this.resetToolBox()},toolBoxMouseUp(){this.toolBox.x=parseInt(this.toolBoxPosition.x),this.toolBox.y=parseInt(this.toolBoxPosition.y),this.toolBox.disable=!0,this.dropImg.active=!1,this.resetToolBox()},printImg(){if(this.drawImg.img){let i=this.$refs.canvas,t=i.getContext("2d");t.font="18px bold 黑体",t.fillStyle="#ff0",t.textAlign="center",t.textBaseline="middle",t.save(),t.clearRect(0,0,i.width,i.height),t.translate(this.drawImg.x+this.drawImg.width/2,this.drawImg.y+this.drawImg.height/2),t.rotate(this.rotateImg.angle*Math.PI/180),t.translate(-(this.drawImg.x+this.drawImg.width/2),-(this.drawImg.y+this.drawImg.height/2)),t.translate(this.drawImg.x,this.drawImg.y),t.scale(this.isFlipHorizontal?-1:1,this.isFlipVertically?-1:1),t.drawImage(this.drawImg.img,this.drawImg.sx,this.drawImg.sy,this.drawImg.swidth,this.drawImg.sheight,this.isFlipHorizontal?-this.drawImg.width:0,this.isFlipVertically?-this.drawImg.height:0,this.drawImg.width,this.drawImg.height),t.translate(-this.drawImg.x,this.drawImg.y),t.restore(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(()=>{this.cropPicture(!0)},100)}},dropImgOn(i){this.imgMove===!0&&(this.dropImg.active=!0,this.dropImg.params={...this.drawImg},this.dropImg.pageX=i.pageX,this.dropImg.pageY=i.pageY)},dropImgOff(){this.dropImg.active=!1,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(()=>{this.cropPicture(!0)},100)},dropImgMove(i){if(this.dropImg.active&&this.drawImg.img){let t={...this.drawImg};t.x=this.dropImg.params.x-(this.dropImg.pageX-i.pageX),t.y=this.dropImg.params.y-(this.dropImg.pageY-i.pageY),this.toolBoxOverflow||(t.x>this.toolBox.x&&(t.x=this.toolBox.x),t.x<this.toolBox.x+this.toolBox.width-t.width&&(t.x=this.toolBox.x+this.toolBox.width-t.width),t.y>this.toolBox.y&&(t.y=this.toolBox.y),t.y<this.toolBox.y+this.toolBox.height-t.height&&(t.y=this.toolBox.y+this.toolBox.height-t.height)),this.drawImg=t,this.printImg(),i.stopPropagation()}},scaleReset(){this.drawImg.width=this.drawImg.swidth,this.drawImg.height=this.drawImg.sheight,this.printImg()},scaleImgWheel(i){if(this.drawImg.img&&this.scaleAble===!0){let t,e=i||window.event;e.wheelDelta?t=-(e.wheelDelta/40):e.detail&&(t=e.detail);let s=50;this.drawImg.x=this.drawImg.width-t*9>s?this.drawImg.x+t*3:this.drawImg.x,this.drawImg.y=this.drawImg.width-t*9>s?this.drawImg.y+t*3:this.drawImg.y,this.drawImg.width=this.drawImg.width-t*9>s?this.drawImg.width-t*9:s,this.drawImg.height=this.drawImg.width/this.scaleImg.rate,this.checkToolBoxOverflow().then(()=>{this.printImg(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(()=>{this.cropPicture(!0)},100)})}return i.preventDefault(),i.returnValue=!1,!1},flipHorizontal(){this.drawImg.img&&(this.isFlipHorizontal==!1?this.isFlipHorizontal=!0:this.isFlipHorizontal=!1,this.printImg())},flipVertically(){this.drawImg.img&&(this.isFlipVertically==!1?this.isFlipVertically=!0:this.isFlipVertically=!1,this.printImg())},turnImg(i){let e=this.rotateImg.angle+i;e>=-180&&e<=180&&(this.rotateImg.angle=e,this.rotateControl.position=e/180*100+100,this.printImg("rotate"))},turnReset(){this.rotateImg.angle=0,this.rotateControl.position=100,this.printImg("rotate")},controlBtnMouseDown(i,t){this.controlBox.disable=!1,this.controlBox.btnName=t,this.controlBox.start.x=i.clientX,this.controlBox.start.y=i.clientY,this.controlBox.start.width=this.toolBox.width,this.controlBox.start.height=this.toolBox.height,i.stopPropagation()},controlBtnMouseUp(i){this.controlBox.disable=!0,this.dropImgOff(),this.resetToolBox(),this.toolBoxMouseUp(),i.stopPropagation()},controlBtnMouseMove(i){if(this.controlBox.disable===!1){let t=i.clientX-this.controlBox.start.x,e=i.clientY-this.controlBox.start.y,s,r;if(this.controlBox.btnName=="leftUp"){if(!this.rate)s=this.toolBox.x+t,r=this.toolBox.y+e;else{let o=this.rate.split(":")[0]/this.rate.split(":")[1];o>=1?(s=this.toolBox.x+t,r=this.toolBox.y+t/o):(s=this.toolBox.x+e*o,r=this.toolBox.y+e)}this.toolBox.width=this.controlBox.start.width-t,this.toolBox.height=this.controlBox.start.height-e}if(this.controlBox.btnName=="rightUp"){if(!this.rate)s=this.toolBox.x,r=this.toolBox.y+e;else{let o=this.rate.split(":")[0]/this.rate.split(":")[1];o>=1?(s=this.toolBox.x,r=this.toolBox.y-t/o):(s=this.toolBox.x,r=this.toolBox.y+e)}this.toolBox.width=this.controlBox.start.width+t,this.toolBox.height=this.controlBox.start.height-e}if(this.controlBox.btnName=="rightDown"&&(s=this.toolBox.x,r=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+t,this.toolBox.height=this.controlBox.start.height+e),this.controlBox.btnName=="leftDown"){if(!this.rate)s=this.toolBox.x+t,r=this.toolBox.y;else{let o=this.rate.split(":")[0]/this.rate.split(":")[1];o>=1?(s=this.toolBox.x+t,r=this.toolBox.y):(s=this.toolBox.x+-e*o,r=this.toolBox.y)}this.toolBox.width=this.controlBox.start.width-t,this.toolBox.height=this.controlBox.start.height+e}this.controlBox.btnName=="topCenter"&&(s=this.toolBox.x,r=this.toolBox.y+e,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height-e),this.controlBox.btnName=="downCenter"&&(s=this.toolBox.x,r=this.toolBox.y,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height+e),this.controlBox.btnName=="leftCenter"&&(s=this.toolBox.x+t,r=this.toolBox.y,this.toolBox.width=this.controlBox.start.width-t,this.toolBox.height=this.controlBox.start.height),this.controlBox.btnName=="rightCenter"&&(s=this.toolBox.x,r=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+t,this.toolBox.height=this.controlBox.start.height),this.drawControlBox(this.toolBox.width,this.toolBox.height,s,r)}i.stopPropagation()},changeFileName(i,t){let e=i.lastIndexOf(".");return i.substr(0,e+1)+(t==="jpeg"?"jpg":t)},cropPicture(i){let t=this;if(this.drawImg.img){let e=this.$refs.canvas;if(this.WatermarkText&&!i){let r=e.getContext("2d");r.font=this.WatermarkTextFont,r.fillStyle=this.WatermarkTextColor,r.textAlign="right",r.textBaseline="bottom",r.fillText(this.WatermarkText,this.toolBox.x+this.toolBox.width*this.WatermarkTextX,this.toolBox.y+this.toolBox.height*this.WatermarkTextY)}let s=new Image;this.crossOrigin===!0&&(s.crossOrigin=this.crossOriginHeader),s.src=e.toDataURL("image/".concat(this.fileType),t.quality),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:(r,o,l)=>{window.atob?setTimeout(()=>{let h=atob(e.toDataURL(o,l).split(",")[1]),d=h.length,a=new Uint8Array(d),x;for(let w=0;w<d;w++)a[w]=h.charCodeAt(w);try{x=new Blob([a],{type:"image/".concat(t.fileType)})}catch(w){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,w.name=="TypeError"&&window.BlobBuilder){const f=window.BlobBuilder;let v=new f;v.append(a.buffer),x=v.getBlob("image/".concat(t.fileType))}w.name=="InvalidStateError"&&(x=new Blob([a.buffer],{type:"image/".concat(t.fileType)}))}r(x)},200):r(!1,{type:"image/".concat(t.fileType)})}}),e.toBlob(r=>{if(r){let o=new FileReader;o.readAsDataURL(r),o.onload=()=>{let l=setInterval(()=>{if(o.readyState==2){clearInterval(l);let h=document.createElement("canvas"),d=h.getContext("2d");if(t.originalGraph==!0){let a=t.drawImg.width/t.drawImg.swidth,x=t.toolBox.width/a,w=t.toolBox.height/a;h.width=x,h.height=w;let f=(t.toolBox.x-t.drawImg.x)/a,v=(t.toolBox.y-t.drawImg.y)/a,H=t.drawImg.swidth,L=t.drawImg.sheight;d.translate(-f,-v),d.drawImage(t.drawImg.img,0,0,H,L)}else{h.width=t.toolBox.width,h.height=t.toolBox.height;let a=t.toolBox;if(t.rate){let x=t.rate.split(":")[0]/t.rate.split(":")[1],w=t.rate.split(":")[0],f=t.rate.split(":")[1];w>=f?d.drawImage(s,a.x,a.y,a.width,a.width*x,0,0,a.width,a.width*x):d.drawImage(s,a.x,a.y,a.width,a.width/x,0,0,a.width,a.width/x)}else d.drawImage(s,a.x,a.y,a.width,a.height,0,0,a.width,a.height)}h.toBlob(a=>{let x=t.changeFileName(t.fileName,t.fileType);i?t.previewMode&&t.$emit("onPrintImg",{index:t.index,fileName:x,blob:a,file:t.dataURLtoFile(h.toDataURL("image/".concat(t.fileType),t.quality),x),dataURL:h.toDataURL("image/".concat(t.fileType),t.quality)}):(t.handleClose(),t.$emit("cutDown",{index:t.index,fileName:x,blob:a,file:t.dataURLtoFile(h.toDataURL("image/".concat(t.fileType),t.quality),x),dataURL:h.toDataURL("image/".concat(t.fileType),t.quality)}))},"image/".concat(t.fileType),t.quality)}},200)}}else{let o=document.createElement("canvas");o.width=t.toolBox.width,o.height=t.toolBox.height;let l=o.getContext("2d"),h=t.toolBox;if(t.rate){let a=t.rate.split(":")[0]/t.rate.split(":")[1];l.drawImage(s,h.x,h.y,h.width,h.width*a,0,0,h.width,h.width*a)}else l.drawImage(s,h.x,h.y,h.width,h.height,0,0,h.width,h.height);let d=t.changeFileName(t.fileName,t.fileType);i?t.$emit("onPrintImg",{fileName:d,dataURL:o.toDataURL("image/".concat(t.fileType),t.quality)}):(t.handleClose(),t.$emit("cutDown",{fileName:d,dataURL:o.toDataURL("image/".concat(t.fileType),t.quality)}))}},"image/".concat(t.fileType),t.quality)}else i||t.$emit("error",{err:1,msg:"No picture selected"})},scrollBarControlMove(i){if(this.rotateControl.active){let t=i.pageX-this.rotateControl.start.x,e=this.rotateControl.start.position+t;e<=0&&(e=0),e>=200&&(e=200),this.rotateControl.position=e,this.rotateImg.angle=(e-100)/100*180,this.printImg()}},scrollBarControlOn(i){this.rotateControl.active=!0,this.rotateControl.start.x=i.pageX,this.rotateControl.start.y=i.pageY,this.rotateControl.start.position=this.rotateControl.position},scrollBarControlOff(){this.rotateControl.active=!1}},computed:{showToolBoxWidth(){let i;return this.originalGraph?i=this.toolBox.width/(this.drawImg.width/this.drawImg.swidth):i=this.toolBox.width,Number(i).toFixed(0)},showToolBoxHeight(){let i;return this.originalGraph?i=this.toolBox.height/(this.drawImg.width/this.drawImg.swidth):i=this.toolBox.height,Number(i).toFixed(0)},showToolBoxX(){let i;return i=this.toolBoxPosition.x,Number(i).toFixed(0)},showToolBoxY(){let i;return i=this.toolBoxPosition.y,Number(i).toFixed(0)}}},_={class:"toolMain"},$={key:0,class:"tool-title"},tt={class:"tips"},et={key:0,class:"dockBtn"},ot={key:4,class:"dockBtnScrollBar"},it={class:"toolBoxControlBox"},lt={class:"controlBox"},st={class:"selectArea"},rt={class:"copyright"},ht={key:0,target:"_blank",href:"https://github.com/acccccccb/vue-img-cutter",rel:"nofollow"},at=["width","height"],nt=["width","height"],dt={class:"i-dialog-footer",style:{height:"40px"}},gt=["accept"],mt={key:0,class:"btn btn-primary btn-primary-plain"},ut={class:"btn-group fr"},xt=["disabled"];function ft(i,t,e,s,r,o){return g(),m("div",null,[e.showChooseBtn===!0&&e.isModal===!0?(g(),m("div",{key:0,onClick:t[0]||(t[0]=(...l)=>o.handleOpen&&o.handleOpen(...l))},[B(i.$slots,"openImgCutter",{},void 0,!0),B(i.$slots,"open",{},void 0,!0)])):u("",!0),!i.$slots.openImgCutter&&!i.$slots.open&&e.isModal===!0?(g(),m("button",{key:1,type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=(...l)=>o.handleOpen&&o.handleOpen(...l))},c(e.label),1)):u("",!0),b(k,{name:"fade"},{default:p(()=>[r.visible?(g(),m("div",{key:0,class:C(e.isModal===!0?"mask vue-img-cutter":""),ref:"mask"},[r.visible?(g(),m("div",{key:0,class:C(e.isModal===!0?"dialogBoxModal":"dialogBox")},[b(k,{name:"fade","enter-class":"fade-in-enter","enter-active-class":"fade-in-active","leave-class":"fade-out-enter","leave-active-class":"fade-out-active"},{default:p(()=>[n("div",{ref:"dialogMainModalRef",class:C(e.isModal===!0?"dialogMainModal":"dialogMain"),style:y("width:"+(e.isModal===!0?e.boxWidth+32:e.boxWidth)+"px")},[n("div",_,[e.isModal===!0?(g(),m("div",$,[t[37]||(t[37]=I(" 图片裁剪 ")),n("span",{class:"closeIcon",onClick:t[2]||(t[2]=(...l)=>o.handleClose&&o.handleClose(...l))},"×")])):u("",!0),n("div",{ref:"toolBox",style:y("height:"+e.boxHeight+"px;width:"+e.boxWidth+"px"),onMousemove:t[30]||(t[30]=(...l)=>o.controlBtnMouseMove&&o.controlBtnMouseMove(...l)),onMouseup:t[31]||(t[31]=(...l)=>o.controlBtnMouseUp&&o.controlBtnMouseUp(...l)),onMouseleave:t[32]||(t[32]=(...l)=>o.controlBtnMouseUp&&o.controlBtnMouseUp(...l)),class:"toolBox"},[M(n("div",tt,[n("div",{class:"btn btn-warning btn-xs",onClick:t[3]||(t[3]=(...l)=>o.chooseImg&&o.chooseImg(...l))},c(e.label),1)],512),[[T,!r.drawImg.img&&e.showChooseBtn===!0]]),e.tool==!0?M((g(),m("div",{key:0,class:"dockMain",style:y("background:"+e.toolBgc),onMouseenter:t[14]||(t[14]=(...l)=>o.dropImgOff&&o.dropImgOff(...l))},[e.rate?(g(),m("div",et,[B(i.$slots,"ratio",{},()=>[t[38]||(t[38]=I(" Ratio: "))],!0),I(" "+c(e.rate),1)])):u("",!0),n("div",{class:"dockBtn",onClick:t[4]||(t[4]=(...l)=>o.scaleReset&&o.scaleReset(...l))},[B(i.$slots,"scaleReset",{},()=>[t[39]||(t[39]=I(" Scale: "))],!0),I(" "+c(r.drawImg.swidth>0?(r.drawImg.width/r.drawImg.swidth).toFixed(2):"-"),1)]),e.originalGraph===!1?(g(),m("div",{key:1,onClick:t[5]||(t[5]=l=>o.turnImg(-90)),class:"dockBtn"},[B(i.$slots,"turnLeft",{},()=>[t[40]||(t[40]=I(" ↳ "))],!0)])):u("",!0),e.originalGraph===!1?(g(),m("div",{key:2,onClick:t[6]||(t[6]=l=>o.turnImg(90)),class:"dockBtn"},[B(i.$slots,"turnRight",{},()=>[t[41]||(t[41]=I(" ↲ "))],!0)])):u("",!0),e.originalGraph===!1?(g(),m("div",{key:3,onClick:t[7]||(t[7]=l=>o.turnReset()),class:"dockBtn"},[B(i.$slots,"reset",{},()=>[t[42]||(t[42]=I(" ↻ "))],!0)])):u("",!0),e.originalGraph===!1?(g(),m("div",ot,[n("div",{ref:"dockBtnScrollControl",onMousemove:t[8]||(t[8]=(...l)=>o.scrollBarControlMove&&o.scrollBarControlMove(...l)),onMousedown:t[9]||(t[9]=(...l)=>o.scrollBarControlOn&&o.scrollBarControlOn(...l)),onMouseleave:t[10]||(t[10]=(...l)=>o.scrollBarControlOff&&o.scrollBarControlOff(...l)),onMouseup:t[11]||(t[11]=(...l)=>o.scrollBarControlOff&&o.scrollBarControlOff(...l)),style:y("left:"+r.rotateControl.position+"px"),class:"scrollBarControl"},null,36),r.rotateControl.active==!0?(g(),m("div",{key:0,class:"scrollBarText",style:y("left:"+r.rotateControl.position+"px")},c(r.rotateImg.angle.toFixed(0)+"°"),5)):u("",!0)])):u("",!0),e.originalGraph===!1?(g(),m("div",{key:5,onClick:t[12]||(t[12]=(...l)=>o.flipHorizontal&&o.flipHorizontal(...l)),class:"dockBtn"},[B(i.$slots,"flipHorizontal",{},()=>[t[43]||(t[43]=I(" ⇆ "))],!0)])):u("",!0),e.originalGraph===!1?(g(),m("div",{key:6,onClick:t[13]||(t[13]=(...l)=>o.flipVertically&&o.flipVertically(...l)),class:"dockBtn"},[B(i.$slots,"flipVertically",{},()=>[t[44]||(t[44]=I(" ⇅ "))],!0)])):u("",!0)],36)),[[T,r.drawImg.img&&r.dropImg.active!==!0&&r.controlBox.disable==!0&&r.toolBox.disable==!0]]):u("",!0),M(n("div",{ref:"toolBoxControl",onMousedown:t[23]||(t[23]=(...l)=>o.toolBoxMouseDown&&o.toolBoxMouseDown(...l)),onMouseup:t[24]||(t[24]=(...l)=>o.toolBoxMouseUp&&o.toolBoxMouseUp(...l)),onMousemove:t[25]||(t[25]=(...l)=>o.toolBoxMouseMove&&o.toolBoxMouseMove(...l)),onMouseleave:t[26]||(t[26]=(...l)=>o.toolBoxMouseLeave&&o.toolBoxMouseLeave(...l)),class:"toolBoxControl",style:y({pointerEvents:e.moveAble?"auto":"none"})},[n("div",it,[n("div",lt,[t[45]||(t[45]=n("div",{class:"controlBoxInnerLine controlBoxInnerLineTop"},null,-1)),t[46]||(t[46]=n("div",{class:"controlBoxInnerLine controlBoxInnerLineBottom"},null,-1)),t[47]||(t[47]=n("div",{class:"controlBoxInnerLine controlBoxInnerLineLeft"},null,-1)),t[48]||(t[48]=n("div",{class:"controlBoxInnerLine controlBoxInnerLineRight"},null,-1)),n("div",st," 宽:"+c(o.showToolBoxWidth)+" 高:"+c(o.showToolBoxHeight)+" (x:"+c(o.showToolBoxX)+",y:"+c(o.showToolBoxY)+") ",1),e.sizeChange===!0?(g(),m("div",{key:0,"data-name":"leftUp",onMousedown:t[15]||(t[15]=l=>o.controlBtnMouseDown(l,"leftUp")),class:"leftUp controlBtn"},null,32)):u("",!0),e.sizeChange===!0?(g(),m("div",{key:1,"data-name":"leftDown",onMousedown:t[16]||(t[16]=l=>o.controlBtnMouseDown(l,"leftDown")),class:"leftDown controlBtn"},null,32)):u("",!0),e.sizeChange===!0?(g(),m("div",{key:2,"data-name":"rightUp",onMousedown:t[17]||(t[17]=l=>o.controlBtnMouseDown(l,"rightUp")),class:"rightUp controlBtn"},null,32)):u("",!0),e.sizeChange===!0?(g(),m("div",{key:3,"data-name":"rightDown",onMousedown:t[18]||(t[18]=l=>o.controlBtnMouseDown(l,"rightDown")),class:"rightDown controlBtn"},null,32)):u("",!0),e.sizeChange===!0&&!e.rate&&r.toolBox.width>20?(g(),m("div",{key:4,"data-name":"topCenter",onMousedown:t[19]||(t[19]=l=>o.controlBtnMouseDown(l,"topCenter")),class:"topCenter controlBtn"},null,32)):u("",!0),e.sizeChange===!0&&!e.rate&&r.toolBox.width>20?(g(),m("div",{key:5,"data-name":"downCenter",onMousedown:t[20]||(t[20]=l=>o.controlBtnMouseDown(l,"downCenter")),class:"downCenter controlBtn"},null,32)):u("",!0),e.sizeChange===!0&&!e.rate&&r.toolBox.height>20?(g(),m("div",{key:6,"data-name":"leftCenter",onMousedown:t[21]||(t[21]=l=>o.controlBtnMouseDown(l,"leftCenter")),class:"leftCenter controlBtn"},null,32)):u("",!0),e.sizeChange===!0&&!e.rate&&r.toolBox.height>20?(g(),m("div",{key:7,"data-name":"rightCenter",onMousedown:t[22]||(t[22]=l=>o.controlBtnMouseDown(l,"rightCenter")),class:"rightCenter controlBtn"},null,32)):u("",!0)]),t[49]||(t[49]=n("div",{class:"toolBoxControlLine toolBoxControlLineItem-1"},null,-1)),t[50]||(t[50]=n("div",{class:"toolBoxControlLine toolBoxControlLineItem-2"},null,-1)),t[51]||(t[51]=n("div",{class:"toolBoxControlLine toolBoxControlLineItem-3"},null,-1)),t[52]||(t[52]=n("div",{class:"toolBoxControlLine toolBoxControlLineItem-4"},null,-1))])],36),[[T,r.drawImg.img!=null]]),n("div",rt,[e.DoNotDisplayCopyright?u("",!0):(g(),m("a",ht," vue-img-cutter "+c(r.version),1))]),n("canvas",{class:"canvasSelectBox",ref:"canvasSelectBox",width:e.boxWidth,onMousedown:t[27]||(t[27]=(...l)=>o.dropImgOn&&o.dropImgOn(...l)),onMouseup:t[28]||(t[28]=(...l)=>o.dropImgOff&&o.dropImgOff(...l)),onMousemove:t[29]||(t[29]=(...l)=>o.dropImgMove&&o.dropImgMove(...l)),height:e.boxHeight},null,40,at),n("canvas",{class:"canvas",ref:"canvas",width:e.boxWidth,height:e.boxHeight},null,8,nt)],36)]),n("div",dt,[n("input",{onChange:t[33]||(t[33]=(...l)=>o.putImgToCanv&&o.putImgToCanv(...l)),ref:"inputFile",type:"file",accept:e.accept,style:{width:"1px",height:"1px",border:"none",opacity:"0"}},null,40,gt),n("span",{onClick:t[34]||(t[34]=(...l)=>o.chooseImg&&o.chooseImg(...l))},[B(i.$slots,"choose",{},()=>[e.showChooseBtn===!0?(g(),m("div",mt,c(e.label),1)):u("",!0)],!0)]),n("div",ut,[n("span",{onClick:t[35]||(t[35]=(...l)=>o.handleClose&&o.handleClose(...l))},[B(i.$slots,"cancel",{},()=>[t[53]||(t[53]=n("button",{type:"button",class:"btn btn-default"},"取消",-1))],!0)]),n("span",{onClick:t[36]||(t[36]=l=>o.cropPicture(!1))},[B(i.$slots,"confirm",{},()=>[n("button",{type:"button",class:"btn btn-primary",style:{"margin-left":"15px"},disabled:!r.drawImg.img}," 确定 ",8,xt)],!0)])])])],6)]),_:3}),t[54]||(t[54]=n("div",{style:{clear:"both"}},null,-1))],2)):u("",!0)],2)):u("",!0)]),_:3})])}const wt=D(Z,[["render",ft],["__scopeId","data-v-0312735b"]]);function Bt(){function i(t){const e=new Image;e.src=t.dataURL,F(e,"裁剪")}return{cutDown:i}}const ct={class:"sl-layout-content"},It={class:"img-cut-content"},yt=q({__name:"index",setup(i){const{cutDown:t}=Bt();return(e,s)=>{const r=W;return g(),m("div",ct,[b(r,null,{title:p(()=>s[0]||(s[0]=[n("p",null,"图片裁剪",-1)])),default:p(()=>[n("div",It,[b(O(wt),{ref:"imgCutterModal",label:"选择本地图片","file-type":"png","tool-bgc":"none","is-modal":!1,"show-choose-btn":!0,"lock-scroll":!0,"box-width":783,"box-height":458,"cut-width":250,"cut-height":250,"size-change":!0,"move-able":!0,"img-move":!0,"original-graph":!1,"small-to-upload":!0,"save-cut-position":!0,"scale-able":!0,"preview-mode":!0,quality:1,"tool-box-overflow":!0,onCutDown:O(t)},{default:p(()=>s[1]||(s[1]=[n("div",{class:"btn btn-primary"},"选择本地图片",-1)])),_:1},8,["onCutDown"])])]),_:1})])}}}),kt=D(yt,[["__scopeId","data-v-ac78da1b"]]);export{kt as default};
