import J from"./index-C7pjrdL4.js";import{I as Y,b as G,c as K,e as X,f as Z,g as Q,u as $,_ as N}from"./index-D5LWgAiT.js";/* empty css              */import{r as P,c as E,e as T,h,q as S,l as I,Y as e,s as ee,w as te,C as p,y as C,m as _,v as r,K as H,L as W,j as U,O as j,N as oe,F,z as D,o as le}from"./vue--1SVMGhC.js";import{S as R}from"./index-DaoDREIv.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{I as ae,a as ne,b as se,c as ie,d as re,D as ue,F as ce,O as pe,t as de,w as me,r as ye,B as fe}from"./arco-BAtWUo8v.js";import{J as he,s as ge}from"./FileSaver-CeFFL67e.js";import{s as L}from"./loading-DEVpaZ89.js";/* empty css              */import"./pub-DCCNobxc.js";function ve(){const z=P(!1),s={location:[{value:10,label:"铺满"},{value:1,label:"左上"},{value:2,label:"左中"},{value:3,label:"左下"},{value:4,label:"右上"},{value:5,label:"右中"},{value:6,label:"右下"},{value:7,label:"中上"},{value:8,label:"中间"},{value:9,label:"中下"}]},a=P({type:10,iconSize:50,globalAlpha:100,portraitSpacing:20,horizontalSpacing:20,rotateAngle:0,icon:void 0}),d=E(()=>{const{iconSize:m,icon:g}=a.value,l={width:m,height:m};if(!g)return!1;if(g.width>g.height){const v=g.width/g.height;l.height=l.width/v}else{const v=g.height/g.width;l.width=l.height/v}return l});return{visible:z,formList:s,form:a,iconSize:d}}const q=T({__name:"index",props:{type:{type:String,default:""},size:{type:Number,default:20}},setup(z){const s=z,a=E(()=>({fontSize:s.size}));return(d,m)=>s.type==="home"?(h(),S(e(Y),{key:0,style:I(e(a))},null,8,["style"])):s.type==="palette"?(h(),S(e(G),{key:1,style:I(e(a))},null,8,["style"])):s.type==="calendar"?(h(),S(e(ae),{key:2,style:I(e(a))},null,8,["style"])):s.type==="link"?(h(),S(e(ne),{key:3,style:I(e(a))},null,8,["style"])):s.type==="code"?(h(),S(e(K),{key:4,style:I(e(a))},null,8,["style"])):s.type==="image"?(h(),S(e(X),{key:5,style:I(e(a))},null,8,["style"])):s.type==="file-image"?(h(),S(e(se),{key:6,style:I(e(a))},null,8,["style"])):s.type==="swap"?(h(),S(e(Z),{key:7,style:I(e(a))},null,8,["style"])):s.type==="upload"?(h(),S(e(ie),{key:8,style:I(e(a))},null,8,["style"])):s.type==="edit"?(h(),S(e(re),{key:9,style:I(e(a))},null,8,["style"])):s.type==="tool"?(h(),S(e(Q),{key:10,style:I(e(a))},null,8,["style"])):ee("",!0)}}),_e={style:{width:"30px",height:"30px","line-height":"35px"}},be=T({__name:"index",emits:["onSet"],setup(z,{expose:s,emit:a}){const{$pub:d}=$(),{visible:m,formList:g,form:l,iconSize:v}=ve(),b=P(null),V=a,u=d.slBaseDebounce(()=>{V("onSet",{iconSize:v.value,form:l.value})});te(l.value,()=>{u()});function k(o){const t=o.img;l.value.icon=t,b.value&&(b.value.src=t.src)}return s({show(){m.value=!0},getIconSize(){return v.value},getForm(){return l.value}}),(o,t)=>{const c=ce,y=pe,i=de,n=me,w=ye,x=ue;return h(),S(x,{class:"image-tool-water-mask-drawer",width:380,visible:e(m),footer:!1,onCancel:t[6]||(t[6]=f=>m.value=!e(m))},{title:p(()=>t[7]||(t[7]=[C(" 属性栏 ")])),default:p(()=>[_("div",null,[r(w,{model:e(l)},{default:p(()=>[r(c,{label:"水印图片"},{default:p(()=>[_("div",null,[r(R,{multiple:!1,onOnToImage:k},{default:p(()=>[_("div",_e,[r(q,{type:"image"})])]),_:1}),_("p",null,[H(_("img",{ref_key:"iconPrev",ref:b,class:"water-mark-img"},null,512),[[W,e(l).icon]])])])]),_:1}),r(c,{label:"位置"},{default:p(()=>[r(i,{modelValue:e(l).type,"onUpdate:modelValue":t[0]||(t[0]=f=>e(l).type=f),style:{width:"200px"},placeholder:"Please select ..."},{default:p(()=>[(h(!0),U(F,null,j(e(g).location,(f,M)=>(h(),S(y,{key:M,value:f.value},{default:p(()=>[C(oe(f.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(c,{label:"水印大小"},{default:p(()=>[r(n,{modelValue:e(l).iconSize,"onUpdate:modelValue":t[1]||(t[1]=f=>e(l).iconSize=f),max:500,min:20,step:5},null,8,["modelValue"])]),_:1}),r(c,{label:"透明度"},{default:p(()=>[r(n,{modelValue:e(l).globalAlpha,"onUpdate:modelValue":t[2]||(t[2]=f=>e(l).globalAlpha=f),max:100,min:10},null,8,["modelValue"])]),_:1}),r(c,{label:"上下间距"},{default:p(()=>[r(n,{modelValue:e(l).horizontalSpacing,"onUpdate:modelValue":t[3]||(t[3]=f=>e(l).horizontalSpacing=f),max:500,min:0},null,8,["modelValue"])]),_:1}),r(c,{label:"左右间距"},{default:p(()=>[r(n,{modelValue:e(l).portraitSpacing,"onUpdate:modelValue":t[4]||(t[4]=f=>e(l).portraitSpacing=f),max:500,min:0},null,8,["modelValue"])]),_:1}),r(c,{label:"旋转角度"},{default:p(()=>[r(n,{modelValue:e(l).rotateAngle,"onUpdate:modelValue":t[5]||(t[5]=f=>e(l).rotateAngle=f),max:180,min:-180,step:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),we=N(be,[["__scopeId","data-v-e754056b"]]);function ke(){const{$SlMessage:z,proxy:s}=$();function a(d){if(d.length<1)z.warning("请选择需要添加水印的图片");else{L.show();const m=new he,g=m.folder("images");d.forEach((l,v)=>{const b="refCanvas".concat(v);if(s){const V=s.$refs[b][0];g&&(g.file(l.fileName,V.toDataURL("image/jpeg",1).substring(22),{base64:!0}),v===d.length-1&&(L.hide(),m.generateAsync({type:"blob"}).then(function(u){ge(u,"watermask.zip")})))}})}}return{dowmloadRenderExportImage:a}}function xe(){const{$pub:z,proxy:s}=$(),a=P([]),d=P({}),m=P({});function g(u){a.value.push(u),D(()=>{v(a.value.length-1,u)})}function l(u){m.value=u.iconSize,d.value=u.form,a.value.length&&d.value&&d.value.icon&&a.value.forEach((k,o)=>{v(o,k)})}function v(u,k){D(()=>{const o="refCanvas".concat(u);z.slBasePolling(()=>{const t=s.$refs[o];return t&&t.length>0}).then(()=>{const t=s.$refs[o][0],c=k.width,y=k.height,i=t.getContext("2d");i&&(i.clearRect(0,0,c,y),i.globalAlpha=1,i.drawImage(k.img,0,0,c,y),b(i,k))})})}function b(u,k){const{icon:o,globalAlpha:t,rotateAngle:c}=d.value;if(o){const{height:y,width:i}=m.value,n=V(k);if(n&&n.center){u.globalAlpha=t/100,u.translate(n.center.x,n.center.y),u.rotate(Math.PI/180*c);for(let w=0;w<n.points.length;w++){const x=n.points[w];u.drawImage(o,x.x,x.y,i,y)}u.rotate(Math.PI/180*c*-1),u.translate(n.center.x*-1,n.center.y*-1)}}}function V(u){const{type:k,portraitSpacing:o,horizontalSpacing:t}=d.value,{height:c,width:y}=m.value,i=[];let n;const w=u.width,x=u.height;switch(k){case 1:n={x:0,y:0},i.push({x:o,y:t});break;case 2:n={x:0,y:x/2},i.push({x:o,y:t-c/2});break;case 3:n={x:0,y:x},i.push({x:o,y:(t+c)*-1});break;case 4:n={x:w,y:0},i.push({x:(o+y)*-1,y:t});break;case 5:n={x:w,y:x/2},i.push({x:(o+y)*-1,y:t-c/2});break;case 6:n={x:w,y:x},i.push({x:(o+y)*-1,y:(t+c)*-1});break;case 7:n={x:w/2,y:0},i.push({x:o-y/2,y:t});break;case 8:n={x:w/2,y:x/2},i.push({x:o-y/2,y:t-c/2});break;case 9:n={x:w/2,y:x},i.push({x:o-y/2,y:(t+c)*-1});break;case 10:{n={x:w/2,y:x/2};const f=y+o,M=c+t,A=Math.sqrt(Math.pow(w,2)+Math.pow(x,2))/2;let B=A*-1;for(;B<A;){let O=A*-1;for(;O<A;)i.push({x:O,y:B}),O+=f;B+=M}break}}return{points:i,center:n}}return{imgList:a,maskProp:d,iconSize:m,setWatermask:l,handleBeforeUpload:g,watermaskRenderImg:v}}const Se={class:"sl-layout-content"},Ie={class:"option-btn"},ze={class:"img-list-body"},Ve={class:"img-tip"},Pe={style:{padding:"80px 0"}},Ce={class:"img-list"},Ae=["width","height"],Ue=T({__name:"index",setup(z){const{proxy:s}=$(),{dowmloadRenderExportImage:a}=ke(),{imgList:d,maskProp:m,iconSize:g,setWatermask:l,handleBeforeUpload:v}=xe(),b=P();function V(){a(d.value)}function u(){s&&b.value&&b.value.show()}return le(()=>{D(()=>{b.value&&(g.value=b.value.getIconSize(),m.value=b.value.getForm())})}),(k,o)=>{const t=fe,c=J;return h(),U(F,null,[_("div",Se,[r(c,null,{title:p(()=>o[0]||(o[0]=[_("p",null,"添加水印",-1)])),extra:p(()=>[_("div",Ie,[r(R,{onOnToImage:e(v)},{default:p(()=>[r(t,{type:"primary",status:"success"},{default:p(()=>o[1]||(o[1]=[C("上传图片")])),_:1})]),_:1},8,["onOnToImage"]),r(t,{type:"primary",onClick:V},{default:p(()=>o[2]||(o[2]=[C("导出图片")])),_:1}),r(t,{type:"primary",onClick:u},{default:p(()=>o[3]||(o[3]=[C("设置水印")])),_:1})])]),default:p(()=>[_("div",ze,[H(_("div",Ve,[r(R,{onOnToImage:e(v)},{default:p(()=>[_("div",Pe,[r(q,{type:"upload",size:52}),o[4]||(o[4]=_("p",null,"点击或者拖拽图片到这里",-1))])]),_:1},8,["onOnToImage"])],512),[[W,!e(d).length]]),_("div",Ce,[_("div",null,[(h(!0),U(F,null,j(e(d),(y,i)=>(h(),U("div",{key:i,class:"img-item",style:I({width:y.width+32+"px"})},[_("canvas",{ref_for:!0,ref:"refCanvas"+i,class:"img-canvas",width:y.width,height:y.height},null,8,Ae)],4))),128))])])])]),_:1})]),r(we,{ref_key:"maskPropRef",ref:b,onOnSet:e(l)},null,8,["onOnSet"])],64)}}}),Je=N(Ue,[["__scopeId","data-v-053bb57d"]]);export{Je as default};
